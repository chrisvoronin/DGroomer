//
//  AnniversaryController.m
//  PSA
//
//  Created by Michael Simone on 6/6/09.
//  Copyright 2009 Dropped Pin. All rights reserved.
//

#import "AnniversaryController.h"
#import "ClientViewController.h"

@implementation AnniversaryController

@synthesize myTableView, anniversaryPicker, date;
@synthesize contactController;
@synthesize appDelegate;

// Holder for the original anniversary date
NSString *tmpAnniversary;

- (IBAction)cancel:(id)sender {
	// Restore the original value
	appDelegate.anniversary = tmpAnniversary;
	
	[self.view removeFromSuperview];
}

- (IBAction)save:(id)sender {
	//Write out data to database
	
	NSDateFormatter *dateFormatter = [[[NSDateFormatter alloc] init] autorelease];
	[dateFormatter setDateStyle:NSDateFormatterFullStyle];
	
	appDelegate.anniversary = [dateFormatter stringFromDate:date];
	
	[self.view removeFromSuperview];
	
	[contactController viewWillAppear: YES];
}

- (IBAction)dateChanged:(id)sender {
	
	// Get the value from the picker and set it.
	self.date = [anniversaryPicker date];
	
	NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
    [formatter setDateFormat:@"MMMM dd, yyyy"];

	//Store this off into the appDelegate for later use
	appDelegate.anniversary = [formatter stringFromDate:self.date];
	
    [formatter release];
	
	[myTableView reloadData];
}

- (void)viewWillAppear:(BOOL)animated
{
    if (self.date != nil)
        [self.anniversaryPicker setDate:date animated:YES];
    else 
        [self.anniversaryPicker setDate:[NSDate date] animated:YES];
    
    [super viewWillAppear:animated];
}

// Implement viewDidLoad to do additional setup after loading the view, typically from a nib.
- (void)viewDidLoad {
	
	// Use the delegate to set/get values
	appDelegate = (PSAAppDelegate *)[[UIApplication sharedApplication] delegate];
	
	tmpAnniversary = [[NSString alloc] init];
	
	tmpAnniversary = appDelegate.anniversary;
	
	// Set the background color to a nice yellow image
	self.view.backgroundColor = [UIColor colorWithPatternImage:[UIImage imageNamed:@"yellow_PSA.png"]];
	self.myTableView.backgroundColor = [UIColor clearColor];
	
    [super viewDidLoad];
}

- (void)didReceiveMemoryWarning {
	// Releases the view if it doesn't have a superview.
    [super didReceiveMemoryWarning];
	
	// Release any cached data, images, etc that aren't in use.
}

- (void)viewDidUnload {
	// Release any retained subviews of the main view.
	// e.g. self.myOutlet = nil;
}


- (void)dealloc {
	[tmpAnniversary release];
	[myTableView release];
	[date release];
    [super dealloc];
}

#pragma mark -
#pragma mark Table View Methods
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath 
{
	static NSString *DateCellIdentifier = @"DateCellIdentifier";
    
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:DateCellIdentifier];
    if (cell == nil) 
    {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:DateCellIdentifier] autorelease];
        cell.textLabel.font = [UIFont systemFontOfSize:17.0];
        cell.textLabel.textColor = [UIColor colorWithRed:0.243 green:0.306 blue:0.435 alpha:1.0];
    }
    
    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
    [formatter setDateFormat:@"MMMM dd, yyyy"];
    cell.textLabel.text = [formatter stringFromDate:date];
		
    [formatter release];
	
    return cell;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    return 1;   
}

@end
